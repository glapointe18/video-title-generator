<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Créateur de Pages Titre Multiples</title>

<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cinzel+Decorative&family=Gilda+Display&family=Lobster&family=Montserrat&family=Playfair+Display&family=Roboto+Slab&display=swap" rel="stylesheet">

<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f4f4f4; }
  h1 { margin-bottom: 20px; }
  form { margin-bottom: 20px; max-width: 600px; }
  input, select, button { display: block; margin-bottom: 10px; padding: 8px; width: 100%; }
  .preview {
    width: 800px; height: 450px; border: 2px solid #333; 
    display: flex; flex-direction: column; justify-content: center; 
    align-items: center; text-align: center; 
    background-color: black; position: relative; margin-bottom: 10px; padding: 10px;
    color: white;
  }
  .download-all-btn { padding: 10px 15px; cursor: pointer; max-width: 300px; margin-bottom: 20px; }
  #colorPalette { display:flex; gap:10px; margin-bottom:10px; align-items:center; }
  .colorSwatch { width:40px; height:40px; cursor:pointer; border:2px solid #333; border-radius:5px; }
  .colorSwatch.selected { border:3px solid #fff; }
  #customColor { width:40px; height:40px; border:none; cursor:pointer; }
</style>
</head>
<body>

<h1>Créer des Pages Titre Illimitées</h1>
<form id="titleForm">

  <h2>Informations des artistes (inchangées)</h2>
  <label>Interprète :</label>
  <input type="text" id="interpreter" required placeholder="Ex: John Doe">

  <label>Instrument / Tessiture :</label>
  <input type="text" id="instrumentTessiture" placeholder="Ex: Piano, Soprano">

  <label>Accompagnateur :</label>
  <input type="text" id="accompanist" placeholder="Ex: Jane Smith">

  <label>Instrument Accompagnateur :</label>
  <input type="text" id="instrumentAccomp" placeholder="Ex: Piano">

  <label>Text color :</label>
  <div id="colorPalette">
    <input type="color" id="customColor" value="#ffffff">
  </div>

  <label>Choix de police :</label>
  <select id="fontChoice">
    <option value="'Gilda Display', serif">Gilda Display</option>
    <option value="'Cinzel Decorative', cursive">Cinzel Decorative</option>
    <option value="'Bebas Neue', sans-serif">Bebas Neue</option>
    <option value="'Montserrat', sans-serif">Montserrat</option>
    <option value="'Lobster', cursive">Lobster</option>
    <option value="'Roboto Slab', serif">Roboto Slab</option>
    <option value="'Playfair Display', serif">Playfair Display</option>
  </select>

  <label>Style du texte :</label>
  <select id="fontStyle">
    <option value="normal">Normal</option>
    <option value="italic">Italique</option>
    <option value="bold">Gras</option>
  </select>

  <h2>Titres / Opéra / Compositeur (illimité)</h2>
  <div id="titlesContainer">
    <div class="titleBlock">
      <label>Titre :</label><input type="text" class="videoTitle" placeholder="Ex: Sonate n°5">
      <label>Opera / Source :</label><input type="text" class="operaSource" placeholder="Ex: La Traviata">
      <label>Compositeur :</label><input type="text" class="composer" placeholder="Ex: Beethoven">
    </div>
  </div>
  <button type="button" id="addTitleBtn">Ajouter un autre titre</button>
  <button type="submit">Générer les pages</button>
</form>

<!-- Bouton pour télécharger toutes les images -->
<button id="downloadAllBtn" class="download-all-btn" style="display:none;">Télécharger toutes les pages en ZIP</button>

<div id="previewsContainer"></div>

<!-- Librairies -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.11.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>

<script>
const form = document.getElementById('titleForm');
const previewsContainer = document.getElementById('previewsContainer');
const addTitleBtn = document.getElementById('addTitleBtn');
const titlesContainer = document.getElementById('titlesContainer');
const colorPaletteDiv = document.getElementById('colorPalette');
const customColorInput = document.getElementById('customColor');
const downloadAllBtn = document.getElementById('downloadAllBtn');

const paletteColors = ['#fff2cc', '#ffb1b7', '#7c67ff', '#ffffff', '#ff7456'];
let selectedColor = '#ffffff';

// Générer les swatches
paletteColors.forEach(color => {
  const swatch = document.createElement('div');
  swatch.className = 'colorSwatch';
  swatch.style.background = color;
  swatch.dataset.color = color;
  if(color === '#ffffff') swatch.classList.add('selected');
  colorPaletteDiv.insertBefore(swatch, customColorInput);
});

// Gestion du clic sur les swatches
const colorSwatches = document.querySelectorAll('.colorSwatch');
colorSwatches.forEach(swatch => {
  swatch.addEventListener('click', () => {
    colorSwatches.forEach(s => s.classList.remove('selected'));
    swatch.classList.add('selected');
    selectedColor = swatch.dataset.color;
  });
});

// Couleur personnalisée
customColorInput.addEventListener('change', () => {
  colorSwatches.forEach(s => s.classList.remove('selected'));
  selectedColor = customColorInput.value;
});

// Ajouter un nouveau titre
addTitleBtn.addEventListener('click', () => {
  const newBlock = document.createElement('div');
  newBlock.className = 'titleBlock';
  newBlock.innerHTML = `
    <label>Titre :</label><input type="text" class="videoTitle" placeholder="Ex: Sonate n°5">
    <label>Opera / Source :</label><input type="text" class="operaSource" placeholder="Ex: La Traviata">
    <label>Compositeur :</label><input type="text" class="composer" placeholder="Ex: Beethoven">
  `;
  titlesContainer.appendChild(newBlock);
});

// Générer les previews
form.addEventListener('submit', async (e) => {
  e.preventDefault();
  previewsContainer.innerHTML = '';
  downloadAllBtn.style.display = 'none';

  const interpreter = document.getElementById('interpreter').value;
  const instrumentTessiture = document.getElementById('instrumentTessiture').value;
  const accompanist = document.getElementById('accompanist').value;
  const instrumentAccomp = document.getElementById('instrumentAccomp').value;
  const fontChoice = document.getElementById('fontChoice').value;
  const fontStyle = document.getElementById('fontStyle').value;

  const titleBlocks = titlesContainer.querySelectorAll('.titleBlock');
  const previews = [];

  titleBlocks.forEach((block) => {
    const videoTitle = block.querySelector('.videoTitle').value;
    const operaSource = block.querySelector('.operaSource').value;
    const composer = block.querySelector('.composer').value;
    if(!videoTitle) return;

    const previewDiv = document.createElement('div');
    previewDiv.className = 'preview';
    previewDiv.style.color = selectedColor;
    previewDiv.style.fontFamily = fontChoice;
    previewDiv.style.fontStyle = fontStyle==='italic' ? 'italic':'normal';
    previewDiv.style.fontWeight = fontStyle==='bold' ? 'bold':'normal';

    let secondLine = '';
    if(operaSource) secondLine += `<div style="font-size:42px; font-weight:normal;">${operaSource}</div>`;
    if(composer) secondLine += `<div style="font-size:42px; font-weight:normal;">${composer}</div>`;

    previewDiv.innerHTML = `
      <div style="font-size:42px; font-weight:bold; font-style:italic;">${videoTitle}</div>
      ${secondLine}<br><br>
      <div style="font-size:31px;">${[interpreter, instrumentTessiture].filter(Boolean).join(', ')}</div>
      <div style="font-size:31px;">${[accompanist, instrumentAccomp].filter(Boolean).join(', ')}</div>
    `;

    previewsContainer.appendChild(previewDiv);
    previews.push(previewDiv);
  });

  if(previews.length > 0) {
    downloadAllBtn.style.display = 'block';
  }

  downloadAllBtn.onclick = async () => {
    if(previews.length === 0) return;
    const zip = new JSZip();
    for(let i = 0; i < previews.length; i++){
      const canvas = await html2canvas(previews[i], { scale: 5 });
      const dataUrl = canvas.toDataURL('image/png');
      const imgData = dataUrl.split(',')[1];
      zip.file(`page-titre-${i+1}.png`, imgData, { base64: true });
    }
    const content = await zip.generateAsync({ type: "blob" });
    saveAs(content, "pages-titres.zip");
  };
});
</script>
</body>
</html>
